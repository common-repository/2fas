!function(r){try{var e=r(".js-generate-offline-codes"),o=r(".js-open-migrate-users-modal"),t=r(".js-twofas-migrate-users"),a=r(".js-reload-qr-code"),s=r(".js-reload-qr-code-and-set-modal-status"),n=r(".js-send-sms"),i=r(".js-waiting-button"),d=r(".js-waiting-link"),l=r(".js-autofocus"),c=r(".twofas-reload-warning-modal"),f=r(".twofas-error-modal"),u=r(".twofas-success-modal"),p=r(".twofas-migrate-users-confirmation-modal"),m=r(".twofas-trusted-device"),w=r(".twofas-offline-codes-date"),v=r("#myChart"),g=r("#error-modal-message"),h=r("#success-modal-message"),b=r("img.twofas-qr-code"),j=r(".twofas-spinner-container.twofas-qr-refresh"),y=r(".twofas-admin-users-wrapper h2"),C="",x=0;function k(e){var t,a=(t=e,JSON.parse(t.responseText).error);void 0===a&&(a="Server error occurred. Please try to refresh this page."),g.html(a),f.trigger("display")}function _(e){var t=e.qrCode,a=e.totpSecret;r(".twofas-qr-code").attr("src",t),r(".twofas-totp-secret").html(a),r("#totp-secret").val(a),r(".twofas-mobile-config").attr("href",e.qrCodeMessage),b.removeClass("twofas-hidden"),j.removeClass("twofas-visible")}function q(){var e=r(".twofas-reload-qr-code-form").attr("action"),t={_wpnonce:r('.twofas-buttons-bottom > input[name="_wpnonce"]').val()};b.addClass("twofas-hidden"),j.addClass("twofas-visible"),r.ajax({url:e,type:"post",data:t,success:_,error:k})}function D(e){return twofas.months[e]}function T(){var e=r("#myChart")[0].getContext("2d"),t={datasets:[{data:[r(".js-active-users-count").val(),r(".js-inactive-users-count").val()],backgroundColor:["#202225","#eb1c23"],borderWidth:0}],labels:[twofas.activeUsers,twofas.inactiveUsers]};v=new Chart(e,{type:"doughnut",data:t,options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!1},title:{display:!1},animation:{animateScale:!0,animateRotate:!0},tooltips:{enabled:!0}}}),r("#js-legend").html(v.generateLegend()),v.update()}t.length&&t.on("click",function(e){e.preventDefault(),p.trigger("close"),o.attr("disabled",!0),C=y.html();var t=r("#twofas-migration-users-form").attr("action"),a={_wpnonce:r('#twofas-migration-users-form > input[name="_wpnonce"]').val()},s=0;r.ajax({url:t,type:"post",data:a,error:function(e){k(e)}}),x=setInterval(function(){s=++s%4,y.html(twofas.migrationInProgress+Array(s+1).join("."))},500),v.data.labels[1]=twofas.migratedUsers,v.data.datasets[0].backgroundColor[1]="#10b74a",v.update(),r("#js-legend").html(v.generateLegend()),function a(){setTimeout(function(){r.ajax({url:twofas.ajaxUrl,type:"get",data:{page:twofas.submenuDashboard,"twofas-action":"migration-users-status"},success:function(e){var t=v.data;0<t.datasets.length&&(t.datasets[0].data[1]=e.migrated_users),v.update(),e.migrated_users>=e.active_users_count?(clearInterval(x),y.html(twofas.migrationCompleted),h.html("Migration completed successfully. Now please turn off and uninstall 2FAS Classic plugin."),u.trigger("display"),o.hide(),setTimeout(function(){T(),y.html(C)},3e3)):a()},error:function(e){k(e)}})},1e3)}()}),m.length&&(r(".twofas-trusted-device-country").each(function(e,a){r.get("https://ipapi.co/"+a.innerText+"/json/",function(e){var t=e.country;a.innerText=t||"",a.className+=" twofas-visible"})}),r(".twofas-date").each(function(e,t){var a,s=1e3*t.innerText;isNaN(s)||(t.innerText=D((a=new Date(s)).getMonth())+" "+a.getDate()+", "+a.getFullYear())}),r(".twofas-hour").each(function(e,t){var a,s,o,n,r=1e3*t.innerText;isNaN(r)||(t.innerText=(a=new Date(r),s=a.getHours(),o=a.getMinutes(),n=12<=s?"PM":"AM",12<s&&(s-=12),o<10&&(o="0"+o),s+":"+o+" "+n),t.className+=" twofas-visible")})),w.length&&function(){var e=1e3*w[0].innerText;if(!isNaN(e)){var t=new Date(e),a=D(t.getMonth()),s=t.getDate(),o=t.getFullYear();w[0].innerText=s+" "+a+" "+o}}(),v.length&&T(),l.focus(function(){this.value=this.value}),e.click(function(e){e.preventDefault();var t=r(".twofas-generate-offline-codes-form").attr("action"),a=r('.twofas-generate-offline-codes-form > input[name="_wpnonce"]').val(),n=r(this);n.addClass("twofas-wait").prop("disabled",!0);var s={_wpnonce:a};r.ajax({url:t,type:"post",data:s,success:function(e){var t=e.codes,a=encodeURIComponent(t.join("\n")),s=function(e){var t,a="<code><pre>";for(t in e)e.hasOwnProperty(t)&&(a+=e[t]+"\r\n");return a+="</pre></code>"}(t),o=function(e){var t,a="";for(t in e)e.hasOwnProperty(t)&&(a+='<input type="hidden" name="code['+t+']" value="'+e[t]+'" />');return a}(t);r(".twofas-offline-stats-generated").hide(),r(".twofas-offline-codes-data").html(s),r(".twofas-offline-codes-inputs").html(o),r(".twofas-download-codes-link").attr("href","data:text/plain;charset=utf-8,"+a),r(".twofas-offline-codes-list").show(),r(".js-backup-codes-tick").removeClass("twofas-icon-tick").addClass("twofas-icon-tick-enabled"),n.removeClass("twofas-wait").prop("disabled",!1)},error:function(e){n.removeClass("twofas-wait").prop("disabled",!1),k(e)}})}),a.submit(function(e){e.preventDefault(),q()}),r(document).on("click",".js-reload-qr-code",function(e){e.preventDefault(),q()}),s.submit(function(e){if(e.preventDefault(),r("#reload-modal-check").is(":checked")){var t=r(".js-reload-qr-code-and-set-modal-status").attr("action"),a={_wpnonce:r('.js-reload-qr-code-and-set-modal-status > input[name="_wpnonce"]').val()};r.ajax({url:t,type:"post",data:a,error:k}),r(".twofas-reload-qr-code-form").removeClass("js-open-reload-warning-modal").addClass("js-reload-qr-code")}c.trigger("close"),q()}),n.click(function(e){e.preventDefault();var t=r(this);t.addClass("twofas-wait").prop("disabled",!0);var a=r(".twofas-send-sms-form").attr("action"),s=r('.twofas-send-sms-form > input[name="_wpnonce"]').val(),o=r("#phone-number").val(),n={phone_number:o,_wpnonce:s};r.ajax({url:a,type:"post",data:n,success:function(e){r("#verified-phone-number").val(o),r("#authentication-id").val(e.authenticationId),r(".twofas-sms-sent-button-text").hide(),r(".twofas-sms-sent-message").show(),t.removeClass("twofas-wait"),r("#twofas-token").prop("disabled",!1),r(".twofas-enable-token-btn").prop("disabled",!1)},error:function(e){t.removeClass("twofas-wait").prop("disabled",!1),k(e)}})}),i.submit(function(e){e.preventDefault();var t=this;return r(this).find('*[type="submit"]').addClass("twofas-wait").prop("disabled",!0),setTimeout(function(){t.submit()},1),!0}),d.click(function(){r(this).addClass("twofas-wait").prop("disabled",!0)})}catch(e){Sentry.captureException(e),g.html("Server error occurred. Please try to refresh this page."),f.trigger("display")}}(jQuery);